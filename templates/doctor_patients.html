{% extends "doctor_base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="h3">My Patients</h2>
        <p class="text-muted">View and manage your assigned patients.</p>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card border-primary">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted">Total Patients</h6>
                        <h3 class="text-primary">{{ patients|length }}</h3>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-users text-primary fs-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card border-success">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted">Active Cases</h6>
                        <h3 class="text-success">{{ patients|selectattr("appointment_count", "gt", 0)|list|length }}</h3>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-user-check text-success fs-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card border-warning">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted">Recent Visits</h6>
                        <h3 class="text-warning">{{ patients|selectattr("last_visit")|list|length }}</h3>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-calendar-check text-warning fs-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card border-info">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted">Follow-ups</h6>
                        <h3 class="text-info">{{ patients|selectattr("appointment_count", "gt", 1)|list|length }}</h3>
                    </div>
                    <div class="flex-shrink-0">
                        <i class="fas fa-redo text-info fs-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Patients Table -->
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">Patient List</h5>
    </div>
    <div class="card-body">
        {% if patients %}
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>Patient ID</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Blood Group</th>
                        <th>Appointments</th>
                        <th>Last Visit</th>
                        <th>Address</th>
                    </tr>
                </thead>
                <tbody>
                    {% for patient in patients %}
                    <tr>
                        <td>PAT{{ "%06d"|format(patient.id) }}</td>
                        <td><strong>{{ patient.name }}</strong></td>
                        <td>{{ patient.age }}</td>
                        <td>{{ patient.gender or 'Not specified' }}</td>
                        <td>
                            <span class="badge bg-danger">{{ patient.blood_group or 'N/A' }}</span>
                        </td>
                        <td>
                            <span class="badge bg-primary">{{ patient.appointment_count }}</span>
                        </td>
                        <td>
                            {% if patient.last_visit %}
                                {{ patient.last_visit[0].strftime('%Y-%m-%d') if patient.last_visit[0] else 'Never' }}
                            {% else %}
                                <span class="text-muted">Never</span>
                            {% endif %}
                        </td>
                        <td>{{ patient.address[:30] + '...' if patient.address and patient.address|length > 30 else patient.address or 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-users text-muted fs-1 mb-3"></i>
            <h5 class="text-muted">No patients found</h5>
            <p class="text-muted">You don't have any assigned patients yet.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.stat-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

.table th {
    background-color: #f8f9fa;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
}

.table td {
    vertical-align: middle;
}
</style>
{% endblock %}
